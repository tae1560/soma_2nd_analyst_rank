<script type="text/javascript">
    //mixpanel.track("stock_firms/show", {"base_date" : "<%=session[:base_date]%>", "id" : <%=params[:id]%>, "page" : "<%=params[:page]%>"});
</script>

<h3 class="hidden-phone"><%= link_to "StockFirms", stock_firms_path %> > <%= @stock_firm.name %> (<%=@base_date_string%>)</h3>
<div class="container-fluid">
  <div class="row-fluid">
    <div class="span4">
      <!--Body content-->
      <div  class="full-width input-append">
        <div class="half-width btn-group">
          <button class="full-width btn dropdown-toggle" data-toggle="dropdown">
            <%= display_recent_period_string %>
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu">
            <% RecentPeriod.find_each do |recent_period| %>
                <li><a href="<%=stock_firm_path @stock_firm%>?recent_period_id=<%=recent_period.id%>"><%= display_recent_period_string recent_period %></a></li>
            <% end %>
          </ul>
        </div>
        <div class="half-width btn-group">
          <button class="full-width btn dropdown-toggle" data-toggle="dropdown">
            <%=display_keep_period_string%>
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu">
            <% KeepPeriod.find_each do |keep_period| %>
                <li><a href="<%=stock_firm_path @stock_firm%>?keep_period_id=<%=keep_period.id%>"><%=display_keep_period_string keep_period%></a></li>
            <% end %>
          </ul>
        </div>
        <div class="half-width btn-group hidden-phone">
          <button class="full-width btn dropdown-toggle" data-toggle="dropdown">
            <%= display_loss_cut_string %>
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu">
            <% LossCut.find_each do |loss_cut| %>
                <li><a href="<%=stock_firm_path @stock_firm%>?loss_cut_id=<%=loss_cut.id%>"><%= display_loss_cut_string loss_cut %></span></a></li>
            <% end %>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="visible-phone" style="margin-bottom:3px">
    <img width=140px src="/img/firms/<%=@stock_firm.id%>.png"/>
</div>
<table class="table table-striped table-bordered table-hover">
  <thead>
  <tr>
    <th class="hidden-phone">종목코드</th>
    <th>종목명</th>
    <th class="hidden-phone">증권사명</th>
    <th>추천날짜</th>
    <th>매수 일자</th>
    <th class="hidden-phone">매수일 시가</th>
    <th>매도 일자</th>
    <th class="hidden-phone">매도일 종가</th>
    <th>수익률</th>
    <th class="hidden-phone"></th>
  </tr>
  </thead>
  <% @recommendations.each do |recommendation| %>
      <%
         in_day_candle = recommendation.get_in_day_candle
         out_day_candle = recommendation.get_out_day_candle @keep_period.days.days, @loss_cut.percent
         profit = recommendation.get_profit @keep_period.days.days, @loss_cut.percent
      %>
      <tr>
        <td class="hidden-phone"><%= recommendation.symbol %></td>
        <td><%= recommendation.stock_code.name %></td>
        <td class="hidden-phone"><%= recommendation.stock_firm.name %></td>
        <td class="small-font"><%= Utility.utc_datetime_to_kor_str recommendation.in_date %></td>
        <td class="small-font"><%= in_day_candle && Utility.utc_datetime_to_kor_str(in_day_candle.trading_date) || "-" %></td>
        <td class="hidden-phone"><%= in_day_candle && in_day_candle.open || "-" %></td>
        <td class="small-font"><%= out_day_candle && Utility.utc_datetime_to_kor_str(out_day_candle.trading_date) || "-" %></td>
        <td class="hidden-phone"><%= out_day_candle && out_day_candle.close || "-" %></td>
        <td class=<%= class_of_profit profit %>><%= profit %> %</td>
        <td class="hidden-phone"><a href="http://recommend.finance.naver.com/Home/InLookUp/naver?cmpcd=<%=recommendation.symbol%>&indt=<%= Utility.utc_datetime_to_kor_str recommendation.in_date %>&brknm=<%=recommendation.stock_firm.name%>"
                                    target="_blank"
                                    onclick='mixpanel.track("click chart", {"recommendation_id" : <%=recommendation.id%>,"recommendation_in_date" : <%= Utility.utc_datetime_to_kor_str recommendation.in_date %>, "base_date" : "<%=session[:base_date]%>", "id" : <%=params[:id]%>, "page" : "<%=params[:page]%>"});'>
          차트</a></td>
      </tr>
  <% end %>
</table>

<%= will_paginate @recommendations, :previous_label => t("<<"), :next_label => t(">>"), :page_gap => t("...") %>



